configfile: "config/config.yaml"

import os
import textwrap


include: "rules/prepare_genome.smk"
include: "rules/search_hmmer.smk"
include: "rules/cluster_tnpb.smk"
# include: "rules/remove_duplicate.smk"
# include: "rules/build_consensus.smk"


rule get_elements:
    input:
        filtered=expand("results/genomes/{genome}/multi_copy", genome = config["input"]["genomes"].keys()),
        flanking = expand("results/genomes/{genome}/flanking", genome = config["input"]["genomes"].keys()),
    output:
        outdir=directory("results/elements_list")
    params:
        genomes = list(config["input"]["genomes"].keys()),
    shell:
        textwrap.dedent(r"""
        mkdir -p {output.outdir:q}

        for genome in {params.genomes:q}; do
            for element in $(ls "results/genomes/${{genome}}/multi_copy/"); do
                ln -s ../genomes/${{genome}} {output.outdir:q}/${{element%.faa}}
            done
        done
        """)

